---
title: 'Lab 5: Interaction Contrasts with Two-way Factorial ANOVA'
output:
  html_document:
    toc: true
    toc_depth: 3
---
# 1. Introduction

This tutorial will walk through how to review and run a interaction contrast using two-way factorial ANOVA. We will produce descriptive statistics, check ANOVA assumptions, run a two-way factorial ANOVA, produce effect sizes, and code interaction contrasts according to our research questions.

This tutorial uses data from your textbook (see ['Support Materials' on the textbook webpage](https://www.routledge.com/Design-and-Analysis-in-Educational-Research-ANOVA-Designs-in-SPSS/Strunk-Mwavita/p/book/9781138361164); Bossaert et al., 2011), which focus on the social dimension of inclusion in education in different countries. The columns include the following information:

* `country`: name of country
* `soc_part`: social participation (score)
* `sen2`: students with special educational needs categorization

Theses data are similar to those you will use for Lab 5, though Lab 5 data will include an id variable. 

# 2. Describe Data and ANOVA Assumptions
We will load the packages and read in the data as we have previous labs.
```{r packages, message = FALSE}
# Load necessary packages:
needs(tidyverse, rio, here, knitr, kableExtra, misty, janitor, rstatix, psych, misty)

df <- misty::read.sav(here("kamden-mwavita_data/factorial_ANOVA_Bossaert_et_al.sav"), use.value.labels = TRUE) %>%
  clean_names()

df <- df %>% 
  mutate(sen2 = recode_factor(sen, 
                                 "Typically developing" = "Typically developing",
                                "Special Educational Needs" = "Special needs",
                                "Behavioral needs" = "Special needs",
                                "Other special needs" = "Special needs")) %>% 
  select(1:2,4)
df
```

If you want to explore the dataset, it is good practice to view the structure of the dataset (`str(df)`)and then the top 5 rows (`head(df)`). This way, you can catch if you read in the data correctly, if there are any anomalies, etc. 

Now, we run through the basic descriptives. See Lab 4 for more information or explanations of this code, if needed. 

```{r}
table(df$sen2)
table(df$country)
```

Summary table of the data with both variables: Notice that we do not have an equal number of cases among our groups.
```{r}
df %>% 
  group_by(sen2, country) %>% 
  summarise(n = n()) %>%
  spread(country, n) 
```

Overall descriptive statistics.
```{r}
describe(df)
```
Make sure to interpret overall distribution stats here.

By level: report the mean/sd and describe the distributions for the levels of each variable.
```{r}
#Output for each level - sen2
describeBy(x = df$soc_part, group = df$sen2, 
             mat = TRUE, data = df)

#Output for each level - country
describeBy(x = df$soc_part, group = df$country, 
             mat = TRUE, data = df)
```
### Marginal Means Plots
Pulling from what we learned last week about marginal means as another way to summarize mean values, below we compare the means with each other:
```{r}
# Step 1. Extract means for 
means <- df %>% #creating new object (tibble) with the means of 
  group_by(sen2, country) %>% #grouping our results by our two independent variables, 'country' within levels of 'sen2'
  summarise(mean_soc_part = mean(soc_part)) #extract the mean of dependent variable
means #view new data

# Graphical representation of means
means %>% 
  ggplot(aes(sen2, mean_soc_part, group = country)) +
  geom_point() +
  geom_line(aes(color = country))
```

You can play around with the aesthetics of the graph above. There's not only one way to represent the means, just do is easiest to interpret given your hypotheses/research questions.

### Boxplots
```{r}
df %>% 
  ggplot(aes(x = country, y = soc_part, fill = sen2)) +
  geom_boxplot() +
  theme_minimal() +
  theme(legend.position="bottom")
```

### Homogeneity of variance
Make sure to interpret if all assumptions are met. 
```{r}
car::leveneTest(soc_part ~ sen2*country, data = df, center = "mean")
```

# 3. Two-way Factorial ANOVA and Pairwise Comparisons

### 3.1 Extract marginal means
We can do two-factor contrasts with the emmeans package.
First, we can try using *by* grouping. This output shows us all the estimates by country,
```{r}
needs(emmeans)
model <- lm(soc_part ~ sen2 + country + sen2:country, df) #remember sen2, country, and sen2:country interactions in the model

means_1 <- emmeans(model, specs = "sen2", by = "country") #use the model to calculate means
means_1

pairs(means_1) #now display those means in pairs
```

### 3.2 Produce pairwise comparisons
Use the code below gives us all the comparisons we need altogether by calculating all possible comparisons without "nesting" one factor in another:
```{r}
means_2 <- emmeans(model, ~sen2*country) #use same model but use different specifications
means_2

pairs(means_2) #display means in pairs, unnested
```
Now we have more than we need, so just pull out the values we can actually interpret (similar to what you did in Lab 4).
```{r}
anova_test(df, formula = soc_part ~ sen2 + country + sen2:country, 
                 detailed = TRUE, type = 3, effect.size = "pes")
```

# 4. Factorial ANOVA Interaction Contrasts
We'll run on hypothesis for a _post-hoc_ analysis to model what you'll do for Lab 5.
* Hypothesis - To what extent does the effect of differences between 'typically developing' and 'special needs' depend on Norway vs. Belgium and the Netherlands?

### 4.1 Defining contrasts
This is a 2x3 two-way factorial ANOVA, so we will need to give a contrast coefficient for each of our simple effects (totaling 6 contrast coefficients, one for each combination between IV levels).
```{r}
contrasts <- list( # the contrast coefficients are split to make it easier to track by groups
  hyp1 = c(-1, -1, 
            2, 2,    #these three contrast 'typically developing' between countries
            -1, -1), #these three contrast 'special needs' between countries
  hyp2 = c(-1, 1, 
           1, -1, #these three contrast 'typically developing' between countries
            0, 0) #these three contrast 'special needs' between countries
  )

contrast(means_2, contrasts, adjust = "holm")
```
Our results indicate that the social participation We There is a xx word difference in vocabulary learning between physical science and humanities lectures, depending on lecture method. Additionally, there is a xx word difference when comparing traditional and computer-assisted lecture methods for physical science as compared to social science. 

### 4.2 Effect Sizes
Calculate effect sizes with partial eta squared.
```{r}
effectsize::t_to_eta2(
  t = 6.928,  #hypothetical numbers, fill in your own
  df_error = 1323  #hypothetical numbers, fill in your own
)

#Let's calculate effect size with Omega
needs(MOTE)
omega.F(dfm = 6, dfe = 1323,
      Fvalue = 6.928, n = 1335, a = .05)
```
The partial eta squared of xx indicates that lecture method explains about 3% of the difference in vocabulary learning between physical science and humanities lectures. 

The partial eta squared of xx indicates that lecture method explains about 19% of the difference in vocabulary learning between physical science and social science conditions.
