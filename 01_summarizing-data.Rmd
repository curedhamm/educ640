---
title: "Summarizing Data"
---

Packages used in this tutorial
```{r packages, echo = FALSE, cache= FALSE}
library("tidyverse")
library("here")
library("psych")
library("needs")
library("car")
library("misty")
```

# Introduction

```{r, echo=FALSE}
# Set my default chunk options 
knitr::opts_chunk$set( 
  fig.height=3,   # Default figure size is 3 inches
  cache=TRUE,     # Cache the R code Run to Run
  tidy=FALSE,     # display code as typed
  size="small")   # slightly smaller font for code
```


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
needs(tidyverse, rio, here, knitr, kableExtra, misty)
data <- read.sav(here("kamden-mwavita_data/one-way ANOVA - Fischer et al.sav"), use.value.labels = T)
```

## Installing the `needs` Package

- Can install packages and load them
- No longer need `install.packages()` and `library()`
- It will ask if you would like to load it every time RStudio opens. Select yes.

```{r, eval = FALSE}
install.packages("needs")
```


## Importing the Data
Normally we would use the `import()` function to import our data. However, with the SPSS `.sav` files we don't get factor labels.

``` {r}
data_import <- import(here("kamden-mwavita_data/one-way ANOVA - Fischer et al.sav"))

head(data_import)
```

Notice how we have 1s down the Group column.

## The Fix
For now, when working with `.sav` files we will use the `read.sav()` function from the `misty` package. `use.value.labels = TRUE` tells it to use the labels as the cell values.

``` {r}
needs(misty)
l2_data <- misty::read.sav(here("kamden-mwavita_data/one-way ANOVA - Fischer et al.sav"), use.value.labels = TRUE)

head(l2_data)
```

# Checking The Assumptions of ANOVA
- Independence of observations
- Normality
- Homogeneity of variance

## Descriptive Statistics

Make sure the `psych` package is installed and loaded:
```{r, echo = TRUE}
needs(psych)
```

`describe()` from the `psych` package is one of the more popular functions for descriptive statistics.

```{r, echo = TRUE, eval = FALSE}
describe(data)
```

```{r echo = FALSE, eval = TRUE}
d <- describe(l2_data)
rmarkdown::paged_table(d)
```

## Independence of Observations
 - Do participants cross groups?
 - We know this if we know the study design
 - In this study, each student experienced one and only one lecture

## Normality
- We can check the skew and kurtosis values from our `describe()` output.
- 0 ± 2 is a good rule of thumb for a tenable assumption of normality.

```{r echo = FALSE, eval = TRUE}
d <- as.data.frame(d) %>% 
  select(vars, n, skew, kurtosis)
rmarkdown::paged_table(d)
```

- Group is a categorical variable, so skew and kurtosis can be ignored. 

## Visual Inspection for Normality
- For the most part, plots will be wrapped using the `ggplot()` function.

### Histogram
```{r, echo = TRUE, eval = FALSE}
ggplot(data = l2_data, aes(x = SchoolFunding)) +
  geom_histogram()
```

- `aes()` refers to aesthetics. What are the variables we want represented in our plots? Since we just want counts of a single continuous variable, we just need to specify our `x` (i.e., `x = Group`).

## Histograms
```{r, echo = TRUE, eval = TRUE, message = F, fig.width = 8, fig.height= 6, fig.align='center'}
ggplot(data = l2_data, aes(x = SchoolFunding)) +
  geom_histogram()
```

## Boxplot
- To get boxplots, we just substitute `geom_histogram()` for `geom_boxplot()` and modify our aesthetics.

```{r, echo = TRUE, fig.width = 6, fig.height= 4, fig.align='center'}
ggplot(data = l2_data, aes(x = Group, y = SchoolFunding)) +
  geom_boxplot()
```

## Homogeneity of Variance
Homogeneity test is a separate analysis. We'll just use the `leveneTest()` function for the `car` package. Formula is the same as for the ANOVA we want to run. Specify `center = "mean"` (function's default is median).

``` {r}
needs(car)
car::leveneTest(SchoolFunding ~ Group, data = l2_data, center = "mean")
```

Our significant result shows error variance around the *mean* is equal across groups.

# Computing the F-Ratio

##
The lines of code below return the original data, which was in wide format, by using the `spread()` function (from `tidyr` within `tidyverse` packages).

``` {r}
df_wide <- spread(l2_data, Group, SchoolFunding)
df_wide
```

##

```{r}
SSE.m <- sum( (dat.long$Value - mean(dat.long$Value))^2 ) 

SSE <- sum( (dat$Summer - mean(dat$Summer))^2 +
            (dat$Fall - mean(dat$Fall))^2 +
            (dat$Winter - mean(dat$Winter))^2
            )

SSR <- SSE.m-SSE

MSR <- SSR/2   # (p - 1) or 2 degrees of freedom

MSE <- SSE/20  # (n - p) or 20 degrees of freedom

Fratio <- MSR/MSE

p.val  <- pf(Fratio, 2, 20, lower.tail=FALSE)
```


The function `pf()` compares our F-ratio to the distribution of FHo values one would expect to get if the means between seasons were not different. The two numbers following the F-ratio value are the degrees of freedom for the MSR and the MSE calculated from (p−1) and (n−p) respectively.