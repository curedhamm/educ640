---
title: "Summarizing Data"
---

Packages used in this tutorial
```{r packages, echo = FALSE, cache= FALSE}
```

# Introduction

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
    fig.height=3,   # Default figure size is 3 inches
  cache=TRUE,     # Cache the R code Run to Run
  tidy=FALSE,     # display code as typed
  size="small")   # slightly smaller font for code

needs(tidyverse, rio, here, knitr, kableExtra, misty, janitor, rstatix, psych)

# Set default behavior of ggplot2 graphs to be black/white theme
theme_set(theme_bw())

data <- read.sav(here("kamden-mwavita_data/one-way ANOVA - Fischer et al.sav"), use.value.labels = T)
```

## Installing the `needs` Package

- Can install packages and load them
- No longer need `install.packages()` and `library()`
- It will ask if you would like to load it every time RStudio opens. Select yes.

```{r, eval = FALSE}
install.packages("needs")
```


## Importing the Data
Normally we would use the `import()` function to import our data. However, with the SPSS `.sav` files we don't get factor labels.

``` {r}
data_import <- import(here("kamden-mwavita_data/one-way ANOVA - Fischer et al.sav")) %>% 
  clean_names()

head(data_import)
```

Notice how we have 1s down the group column.

## The Fix
For now, when working with `.sav` files we will use the `read.sav()` function from the `misty` package. `use.value.labels = TRUE` tells it to use the labels as the cell values.

``` {r}
needs(misty)
l2_data <- misty::read.sav(here("kamden-mwavita_data/one-way ANOVA - Fischer et al.sav"), use.value.labels = TRUE) %>% 
  clean_names()

head(l2_data)
```

## Checking The Assumptions of ANOVA
In addition to requiring that the response variable (or dependent variable) must be measured on a continuous scale, there are three assumptions that should be met before proceeding with ANOVA:  
- *Homogeneity of variance*: The variance between the batches should be similar.  
- *Independence of observations*: Observations should be independent of one another.  
- *Normality*: The distribution of values within each group should be normally distributed. If a transformation is applied to the data, it should be applied to all batches. Note that the distribution of values for all combined batches need not be normally distributed.  

## Descriptive Statistics

Make sure the `psych` package is installed and loaded:
```{r, echo = TRUE}
needs(psych)
```

`describe()` from the `psych` package is one of the more popular functions for descriptive statistics.

```{r, echo = TRUE, eval = FALSE}
describe(data)
```

```{r echo = FALSE, eval = TRUE}
d <- describe(l2_data)
rmarkdown::paged_table(d)
```

## Independence of Observations
 - Do participants cross groups?
 - We know this if we know the study design
 - In this study, each student experienced one and only one lecture

## Normality
- We can check the skew and kurtosis values from our `describe()` output.
- 0 ± 2 is a good rule of thumb for a tenable assumption of normality.

```{r echo = FALSE, eval = TRUE}
d <- as.data.frame(d) %>% 
  select(vars, n, skew, kurtosis)
rmarkdown::paged_table(d)
```

- group is a categorical variable, so skew and kurtosis can be ignored. 


## Shapiro's test of Normality
We can also provide some empirical evidence to support the assumption of normality using `shapiro.test()` function.

```{r, echo = TRUE, eval = FALSE}
shapiro.test(l2_data$school_funding)
```

## Visual Inspection for Normality
- For the most part, plots will be wrapped using the `ggplot()` function.

### Histogram
```{r, echo = TRUE, eval = FALSE}
ggplot(data = l2_data, aes(x = school_funding)) +
  geom_histogram()
```

- `aes()` refers to aesthetics. What are the variables we want represented in our plots? Since we just want counts of a single continuous variable, we just need to specify our `x` (i.e., `x = group`).

## Histograms
```{r, echo = TRUE, eval = TRUE, message = F, fig.width = 8, fig.height= 6, fig.align='center'}
ggplot(data = l2_data, aes(x = school_funding)) +
  geom_histogram()
```

## Boxplot
- To get boxplots, we just substitute `geom_histogram()` for `geom_boxplot()` and modify our aesthetics.

```{r, echo = TRUE, fig.width = 6, fig.height= 4, fig.align='center'}
ggplot(data = l2_data, aes(x = group, y = school_funding)) +
  geom_boxplot()
```

## Homogeneity of Variance
Homogeneity test is a separate analysis that we can conduct using the `car` package's `leveneTest()` function. The formula is the same as for the ANOVA we want to run. Specify `center = "mean"` (function's default is median).

``` {r}
needs(car)
car::leveneTest(school_funding ~ group, data = l2_data, center = "mean")
```

Our significant result shows error variance around the *mean* is equal across groups.

# Computing the F-Ratio

##
The lines of code below return the original data, which was in wide format, by using the `spread()` function (from `tidyr` within `tidyverse` packages).

``` {r}
df_wide <- spread(l2_data, group, school_funding) %>% 
            select(2:4) %>% 
            clean_names()

head(df_wide)
```

```{r}
# calculate the between group variance
SSE.m <- sum( (l2_data$school_funding - mean(l2_data$school_funding))^2 ) 

# calculate the within group variance, for each group
SSE.1 <- (df_wide$lower_than_expected - mean(df_wide$lower_than_expected, na.rm = T))^2
SSE.2 <- (df_wide$as_expected - mean(df_wide$as_expected, na.rm = T))^2
SSE.3 <- (df_wide$better_than_expected - mean(df_wide$better_than_expected, na.rm = T))^2

SSE <- sum(SSE.1, SSE.2, SSE.3, na.rm = T)

SSR <- SSE.m-SSE

MSR <- SSR/2   # (p - 1) or 2 degrees of freedom
MSE <- SSE/635  # (n - p) or 20 degrees of freedom

Fratio <- MSR/MSE

p.val  <- pf(Fratio, 2, 635, lower.tail=FALSE)
p.val
```
The function `pf()` compares our F-ratio to the distribution of FHo values one would expect to get if the means between seasons were not different. The two numbers following the F-ratio value are the degrees of freedom for the MSR and the MSE calculated from (p−1) and (n−p) respectively.

```{r}
anova_test(data = l2_data, formula = school_funding ~ group,
           effect.size = "pes")
```